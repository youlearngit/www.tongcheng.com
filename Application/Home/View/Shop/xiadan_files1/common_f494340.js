function addHeadListCart(e){for(var t=$(".dropdown-shopcart"),i="",s=0,o=0;o<e.length;o++)o>4?s++:i+="<li "+(1==e[o].offline?'class="noht"':"")+'><a class="flimg" href="/deal/'+e[o].goods_id+'.html" target="_blank" title="'+e[o].title+'"><img width="66" height="42" src="'+e[o].img+'" /></a><p><a class="tit" href="/deal/'+e[o].goods_id+'.html" target="_blank" title="'+e[o].title+'">'+e[o].title+"</a><span>¥"+100*e[o].price/100+'</span><a class="del" href="javascript:void(0);" _goodsid="'+e[o].goods_id+'" onclick="delFromCart('+e[o].goods_id+')">删除</a></p></li>';t.find(".htul").html(i);var a=s>0?"<em>购物车里还有"+s+"种商品</em>":"";a='<li class="shopcart-but">'+a+'<a href="/order/buy/cart/">去购物车并结算</a></li>',t.find(".htul").append(a),t.find(".htul").find("li").hover(function(){$(this).addClass("hthover")},function(){$(this).removeClass("hthover")})}function delFromCart(e){$.ajax({type:"get",url:"/order/cart/del/",datatype:"json",data:{goods_id:e},success:function(e){0==e.status?($(this).parent().parent().remove(),cartUp()):($(".dropdown-shopcart").trigger("hover"),alert(e.errmsg)),ifGetCart=!0}})}function cartHover(){var e=$(".dropdown-shopcart");return e.length<=0?!1:void e.hover(function(){return 0==e.find(".triangle").length?!1:($(this).addClass("dropdown-hover"),void(ifGetCart&&(cartUp(),ifGetCart=!1)))},function(){$(this).removeClass("dropdown-hover")})}function cartUp(){var e=$(".dropdown-shopcart");$.getJSON("/order.php?act=list_cart",function(t){t&&t.length>0?(addHeadListCart(t),e.find(".text").html("购物车(<b>"+t.length+"</b>)")):(e.find("i.triangle").remove(),e.find(".htul").html(""),e.find(".text").html('<em class="text">购物车(0)</em>'),e.addClass("dropdown-shopbare").removeClass("dropdown-hover").removeClass("dropdown-shopcart"))})}function acountHover(){var e=$(".dropdown-account");e.length>0&&e.hover(function(){$(this).addClass("dropdown-hover")},function(){$(this).removeClass("dropdown-hover")})}function historyHover(){var history=$(".dropdown-history");history.hover(function(){ifGetHistory?$.get("/ajax/get_view_goods.php",function(data){var data=eval("("+data+")");if(""!=data.html){var hishtml=data.html+'<li class="history-empty"><a onclick="emptyHistory();" href="javascript:void(0);">清空浏览记录</a></li>';history.find(".htul").html(hishtml)}else history.find(".htul").html('<li class="history-empty"><em>您还没有浏览记录！</em></li>');history.find(".htul").attr("style",""),ifGetHistory=!1,$(".htul li").hover(function(){$(this).addClass("hthover")},function(){$(this).removeClass("hthover")})}):(history.find(".htul").attr("style",""),0==history.find(".htul li").length&&history.find(".htul").html('<li class="history-empty"><em>您还没有浏览记录！</em></li>')),$(this).addClass("dropdown-hover")},function(){$(this).removeClass("dropdown-hover")})}function addFavor(){$("#AddFavorite").click(function(){var e=window.location.host;sURL="http://"+e+"/?from=favorites";var t="拉手网-超人气团购网站";try{window.external.addFavorite(sURL,t)}catch(i){try{window.sidebar.addPanel(t,sURL,"")}catch(i){alert("抱歉，你的浏览器不支持此操作。\n请使用按键 Ctrl+D 收藏拉手。")}}return!0})}function getGoods(){var e=$(".index-floor.lazyloadfloor");e.each(function(){if($(this).hasClass("lazyloadfloor")&&$(this).offset().top<$(document).scrollTop()+$(window).height()&&$(".floor-title",$(this)).children("a").length>$(".floor-content",$(this)).children("div").length){var e=$("h2.index-floor-title a",$(this)).attr("cate");getgoodsing[e]||(getgoodsing[e]=!0,$.ajax({type:"GET",url:"/index.php?c=index&a=getAjaxFloorGoods",data:"cate="+e+"&city_id="+city_id,dataType:"json",success:function(e){if(e&&e.cate&&(getgoodsing[e.cate]=!1),e&&e.html){var t=$(".floor-content",$(".index-floor.cate"+e.cate));1==t.children("div").length&&($(t).append(e.html),$(t).parents(".index-floor").removeClass("lazyloadfloor"))}}}))}})}function resetIndex(e){$.getJSON("/ajax/ac.php?act=resetIndex&type="+e,function(e){return e.return_url?void(window.location.href=e.return_url):void window.location.reload()})}function showweather(){if($("#header .city")&&$("#header .city").length>0){var e=getCookie("weatherinfo");if(e)var t=e.split(",");e&&t.length>0&&t[0]==$("#header .city h2").text()?setWeatherHtmlCookie(t):$.ajax({type:"GET",url:"/ajax/getWeatherInfoNew.php",data:"",dataType:"text",success:function(e){e?(setCookie("weatherinfo",e,36e5,1,null),setWeatherHtmlCookie(e.split(","))):$("#header .city h2").addClass("wid")}})}setTimeout(function(){showweather()},366e5)}function setWeatherHtmlCookie(e){var t=e[1]<10?"0"+e[1]:e[1],i="";i=e[2]<18?"d":"n";var s=e[3],o="http://s2.lashouimg.com/static/img/other/weather/"+i+"/"+t+".png",a='<img src="'+o+'" width="24" height="24" class="iepng" alt="'+s+'" title="'+s+'"/><span>'+e[4].replace("~","/")+" "+s+"</span>";$("#header .city .weather")&&$("#header .city .weather").length>0?$("#header .city .weather").html(a):$("#header .city").append('<p class="weather">'+a+"</p>")}function getMyMessage(){$("#header .login .account-num")&&$("#header .login .account-num").length>0&&$.getJSON("/account/letter_ajax.php",function(e){if(e){var t=0;$.each(e,function(e,i){t+=i.num}),$("#header .login .account-num").html(t).show()}})}function close_tips(e,t){$(e).parent().remove();var i=getCookie("tips");i+=t,setCookie("tips",i,null,null,null)}function addZanOnclick(e,t){return""==e?!1:void $.ajax({url:"/top/setZan",data:{id:e},type:"post",dataType:"json",success:function(e){if(1==e.status){var i=parseInt($(".zannum").eq(0).text());$("#"+t).addClass("praise-hover"),i+=1,$(".zannum").text(i)}else alert(e.content)}})}function setShareQQTest(e){$("#test_shareQQ-pop").val(e)}function SetRemainTime(){if(DetailSysSecond>0){DetailSysSecond-=1;var e=Math.floor(DetailSysSecond%60),t=Math.floor(DetailSysSecond/60%60),i=Math.floor(DetailSysSecond/3600%24),s=Math.floor(DetailSysSecond/86400);$("#time_over").html("剩余时间："+s+"天"+i+"小时"+t+"分"+e+"秒")}else window.clearInterval(DetailInterValObj),$("#time_over").html("团购已结束")}function time_over(){DetailSysSecond=$("#time_over").attr("time"),259200>=DetailSysSecond&&DetailSysSecond>0&&(DetailInterValObj=window.setInterval(SetRemainTime,1e3))}function new_checksubmit(){var e=$("#sw").val(),t=$.trim(e);return t||(t=$.trim($("#sw").prev().text()),"请输入商品、商家、商圈"!=t&&($("#sw").prev().text("").hide(),$("#sw").val(t),ifclicksubmit=!1)),"请输入商品、商家、商圈"==t||""==t?!1:!0}function timeCounter3(endTime,nowTime,contain,callback){if(endTime=endTime.replace(/-/g,"/"),endTime=new Date(endTime),nowTime=nowTime.replace(/-/g,"/"),nowTime=new Date(nowTime),!(0>endTime-nowTime))var clientStartTime=new Date,tempdif=nowTime.getTime()-clientStartTime.getTime(),timedown=setInterval(function(){var clienTime=new Date;startTime=new Date(clienTime.getTime()+tempdif),remainTime=endTime.getTime()-startTime.getTime();var dayDif=Math.floor(remainTime/864e5),hourDif=endTime.getHours()-startTime.getHours(),minDif=endTime.getMinutes()-startTime.getMinutes(),secDif=endTime.getSeconds()-startTime.getSeconds(),milsecDif=Math.floor((endTime.getMilliseconds()-startTime.getMilliseconds())/10);return 0>milsecDif&&(secDif-=1,milsecDif+=100),0>secDif&&(minDif-=1,secDif+=60),0>minDif&&(hourDif-=1,minDif+=60),0>hourDif&&(hourDif+=24),0>=milsecDif&&0>=secDif&&0>=minDif&&0>=hourDif&&0>=dayDif?(clearInterval(timedown),void("string"==typeof callback?eval(callback+'("'+endTime+'")'):callback(endTime))):(dayDif=0==dayDif?"00":dayDif,hourDif=0==hourDif?"00":hourDif,minDif=0==minDif?"00":minDif,secDif=0==secDif?"00":secDif,milsecDif=0==milsecDif?"00":milsecDif,milsecDif!=contain.find("span:eq(4)").html()&&contain.find("span:eq(4)").html(milsecDif),secDif!=contain.find("span:eq(3)").html()&&contain.find("span:eq(3)").html(secDif),minDif!=contain.find("span:eq(2)").html()&&contain.find("span:eq(2)").html(minDif),hourDif!=contain.find("span:eq(1)").html()&&contain.find("span:eq(1)").html(hourDif),void(dayDif!=contain.find("span:eq(0)").html()&&contain.find("span:eq(0)").html(dayDif)))},1)}function pageShowInit(){if($("#main").length<=0)return!1;var e=0;e=$("#main .sort-filter").length>0?20:$("#main").offset().top;var t=$(window).width();965>t?($(".sidebar-warp").hasClass("sw-open")?$(".sidebar-title").hide():$(".sidebar-title").show(),$(".index-main").css("position","relative"),$(".sidebar-warp").css("top","0px")):1200>t?($(".sidebar-warp").hasClass("sw-open")?$(".sidebar-title").hide():$(".sidebar-title").show(),$(".index-main").css("position","static"),$(".sidebar-warp").css("top",e+"px")):($(".sidebar-warp").removeClass("sw-open").attr("style","auto"),$(".sidebar-title").hide(),$(".index-main").css("position","static"),$(".sidebar-warp").css("top",e+"px"),$(".index-sidebar").attr("style","auto")),$(".scroll-block").css(1320>t?{right:"0px","margin-right":"0px"}:{right:"50%","margin-right":"-665px"}),$(".search-text").hide()}function sider_right_goods(){$("");if($("#list_right_sidebar").length>0&&$("#list_right_sidebar div").length<1){if($("#list_right_sidebar").attr("view")&&"1"==$("#list_right_sidebar").attr("view"))var e="&view=1";else var e="";$.getJSON("/ajax/get_right_goods.php?cid="+$("#list_right_sidebar").attr("cid")+"&cityid="+$("#list_right_sidebar").attr("cityid")+e,function(e){e&&e.html&&$("#list_right_sidebar").html(e.html)})}}function yzmCheck(e,t,i){e.bind("keyup blur",{url:t,dataName:i},function(){var e=$(this);if(4==e.val().length){if("yzm"==i)var s={yzm:e.val()};else if("mobile_yzm"==i)var s={mobile_yzm:e.val()};$.ajax({type:"post",url:t,datatype:"json",data:s,success:function(t){return 1==t?(e.next().addClass("correct").removeClass("error"),e.removeClass("error"),yzmTyp=1):(e.next().addClass("error").removeClass("correct"),e.addClass("error"),yzmTyp=0)}})}else e.next().removeClass("correct"),e.next().removeClass("error")})}function setSearchWord(e){if(""!=e){var t,i=getCookie("s_word_list"),s=0;if(i){t=i.split("|");for(var o=0;o<t.length;o++)if(t[o]==e){t[o]="",s=1;break}var a=t.length>9?9+s:t.length;i="";for(var o=0;a>o;o++)""!=t[o]&&(i+=t[o]+"|");setCookie("s_word_list",e+"|"+toTxt(i),1)}else setCookie("s_word_list",e+"|",1)}}function getSearchWord(){var e,t=getCookie("s_word_list");if($("#searchcookie ul").html(""),t){e=t.split("|");for(var i=0;i<e.length;i++)""!=e[i]&&$("#searchcookie ul").append("<li><span>"+e[i]+'</span><a href="javascript:void(0);"><em class="search-text-close"></em></a></li>');$("#searchcookie ul li").length>0&&($("#searchcookie").show(),$("#searchcookie ul li").bind("mouseover",function(){$(this).addClass("hover")}),$("#searchcookie ul li").bind("mouseout",function(){$(this).removeClass("hover")}),$("#searchcookie ul li span").bind("click",function(){$("#sw").val($(this).text()),ifclicksubmit=!1,$(".scvalue").hide(),$("#searchform").submit(),$("#searchcookie").hide(),$("#sw").parent().addClass("focus")}),$("#searchcookie .search-history a").bind("click",function(){delCookie("s_word_list",null),$("#searchcookie").hide()}),$("#searchcookie ul li a").bind("click",function(){delSearchWord($(this).siblings("span").html()),$(this).parent().hide()}))}}function delSearchWord(e){if(""!=e){var t,i=getCookie("s_word_list");if(i){t=i.split("|");for(var s=0;s<t.length;s++)(t[s]==e||t[s]==toTxt(e))&&(t[s]="");i="";for(var s=0;s<t.length;s++)""!=t[s]&&(i+=t[s]+"|");setCookie("s_word_list",i,1)}}}function searchWordUpDown(e){$("#searchcookie ul li");if($("#searchcookie ul li").length<1)return!1;$("#searchcookie").show();var e=e?e:window.event?window.event:null;if(document.all)var t=e.keyCode;else var t=e.which;var i=$("#searchcookie ul li.hover");40==t&&(i.length>0?""!=i.next().text()?(i.next().addClass("hover"),i.removeClass("hover")):($("#searchcookie ul li:first").addClass("hover"),i.removeClass("hover")):$("#searchcookie ul li:first").addClass("hover")),38==t&&(i.length>0?""!=i.prev().text()?(i.prev().addClass("hover"),i.removeClass("hover")):($("#searchcookie ul li:last").addClass("hover"),i.removeClass("hover")):$("#searchcookie ul li:first").addClass("hover")),13==t&&($("#sw").val(i.text()),ifclicksubmit=!1)}function get_pop_window_htmls(e,t){var i=[];return i.push('<div class="pop" id="'+e+'"><a href="javascript:void(0)" class="pop-close"></a><div class="pop-border"></div>'),i.push('<div class="pop-main">'),i.push(t),i.push("</div></div>"),i.join("")}function slipGoods(){var e=$(".index-goods"),t=$(".big-goods"),i=$(".small-goods"),s=$(".goods");e.length>0&&e.hover(function(){$(this).addClass("index-goodsHover")},function(){$(this).removeClass("index-goodsHover")}),t.length>0&&t.hover(function(){$(this).addClass("big-goodsHover")},function(){$(this).removeClass("big-goodsHover")}),i.length>0&&i.hover(function(){$(this).addClass("small-goodsHover")},function(){$(this).removeClass("small-goodsHover")}),s.length>0&&s.hover(function(){$(this).addClass("goods-hover")},function(){$(this).removeClass("goods-hover")})}function new_checksubmit_again(){var e=$("#sw_again").val(),t=$.trim(e);return t||(t=$.trim($("#sw_again").prev().text()),"请输入商品、商家、商圈"!=t&&($("#sw_again").prev().text("").hide(),$("#sw_again").val(t),settracknum(34e3),ifclicksubmit=!1)),"请输入商品、商家、商圈"==t||""==t?!1:(ifclicksubmit&&settracknum(35e3),!0)}var ifGetCart=!0,ifGetHistory=!0,ifclicksubmit=!0,getgoodsing={99:!1,2:!1,29:!1,46:!1,37:!1,300:!1,400:!1,442:!1,3:!1},DetailSysSecond,DetailInterValObj,yzmTyp=0;$(function(){pageShowInit(),cartHover(),acountHover(),historyHover(),addFavor(),gotop(),getMyMessage(),getGoods(),lazyLoad(),setMoreBtn(),sider_right_goods(),showweather(),slipGoods(),$(window).scroll(function(){getGoods(),lazyLoad()}),$(window).resize(function(){setMoreBtn(),pageShowInit()}),$("#searchform").submit(function(){var e=$("#sw").val().toString().substring(0,26);setSearchWord(toTxt(e))}),$(".scvalue").click(function(){$(this).next().focus()}),$(".sctext").bind("paste",function(){var e=$(this);setTimeout(function(){var t=$(e).val();""!=t&&$(e).siblings("span").hide()},1)}),$(".sctext").focus(function(){$(this).prev().addClass("scvalue-nobg");var e=$.trim($(this).siblings("span").text());""==$(this).val()&&"undefined"==typeof ifsearchlist?($(this).siblings("span").text("请输入商品、商家、商圈"),$(this).parents(".search").length>0&&getSearchWord()):$(this).siblings("span").hide(),"请输入商品、商家、商圈"!=e&&"undefined"!=typeof ifsearchlist&&$(this).siblings("span").hide()}),$(".sctext").keyup(function(){""!=$(this).val()?$("#searchcookie").hide():($(this).siblings("span").show(),$(this).siblings("span").text("请输入商品、商家、商圈"),$(this).parents(".search").length>0&&$("#searchcookie ul li").length>0&&$("#searchcookie").show())}),$(".sctext").keydown(function(e){$(this).siblings("span").hide(),""==$(this).val()&&$(this).parents(".search").length>0&&searchWordUpDown(e)}),$(document).click(function(e){var e=e?e:window.event,t=e.srcElement||e.target;if("sw"!=$(t).attr("id")&&"sw_again"!=$(t).attr("id")&&"sw"!=$(t).attr("name")&&!$(t).hasClass("scvalue")&&!$(t).hasClass("search")&&"searchcookie"!=$(t).attr("id")&&$(t).parents("#searchcookie").length<1){var i=$("#sw").val();""==i&&$(".search .scvalue").show();var s=$("#sw_again").val();""==s&&$(".anew-search .scvalue").show(),setTimeout(function(){$("#searchcookie").hide()},100)}}),$("#sw").length>0&&$("#sw").autocomplete("/ajax/get_query_suggest.php",{minChars:1,left:0,width:0,scrollHeight:240,matchContains:!0,autoFill:!1,matchSubset:!1,delay:500,cacheLength:1,selectFirst:!1,dataType:"json",parse:function(e){return $.map(e,function(e){return{data:e,value:e.name,result:e.name}})},formatItem:function(e){return e.name},formatMatch:function(e){return e.name+" "+e.to},formatResult:function(e){return e.name},resultsClass:"search-text"}).result(function(e,t,i){$("#sw").val(i),ifclicksubmit=!1,$(".scvalue").hide(),$("#searchform").submit()})}),$(function(){$(".index-app-qrcode").length>0&&$(".index-app-qrcode").hover(function(){$(this).find(".iap-con").show()},function(){$(this).find(".iap-con").hide()}),$(".goods").hover(function(){$(this).addClass("goods-hover")},function(){$(this).removeClass("goods-hover")}),$(".sfbc-item-open").hover(function(){$(".sfbc-item-option a",$(this)).length>0&&$(this).addClass("sfbc-item-hover")},function(){$(this).removeClass("sfbc-item-hover")}),$(".sf-select-title a").hover(function(){if($(this).hasClass("disabled"))return!1;var e="sf-select-"+$(this).attr("name");$(this).siblings().removeClass("current"),$(this).addClass("current"),$(this).parent().next().find("ul").hide().siblings("."+e).show()}),$(".handy-dropdown input.handy-input").click(function(){var e=this,t=$(this).parents(".handy-dropdown").find(".address-hot");t.length>0&&(t.find(".address-hotlist").find("a").click(function(){var t=$(this).html();$(e).val(t),$(this).parents(".handy-dropdown").removeClass("handy-dropdown-unfold")}),t.find(".address-hot-close").click(function(){$(this).parents(".handy-dropdown").removeClass("handy-dropdown-unfold")})),$(this).parents(".handy-dropdown").addClass("handy-dropdown-unfold"),$(this).hasClass("hover")||$(this).addClass("hover")})});